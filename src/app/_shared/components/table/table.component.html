<div class="d-flex flex-column h-100">
  <div class="flex-grow-1 overflow-auto">
    <ng-container *ngIf="!showDebug">
      <ng-container *ngIf="data.length; else empty">
        <table class="table mb-0">
          <thead class="thead-light">
            <tr>
              <th *ngFor="let property of schema.properties" [ngStyle]='property.style || {}'>{{property.label}}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of data | paginate:page:limit" [id]="item._id">
              <ng-container *ngFor="let property of schema.properties; let i = index">
                <ng-container [ngSwitch]="property.type">
                  <td *ngSwitchCase="'custom'" [ngStyle]='property.style || {}'>
                    <ng-container *ngTemplateOutlet="templates[property.template]; context:item"></ng-container>
                  </td>
                  <td *ngSwitchCase="'badge'" [ngStyle]='property.style || {}'>
                    <ng-container *ngFor="let badgeItem of property.badgeItems">
                      <div *ngIf="property.val(item) === badgeItem.value" class="badge badge-{{badgeItem.class}} w-100"
                        [ngStyle]='badgeItem.style || {}'>
                        {{badgeItem.label}}
                      </div>
                    </ng-container>
                  </td>
                  <td *ngSwitchCase="'button'" [ngStyle]='property.style || {}'>
                    <button class="btn btn-sm btn-outline-secondary" (click)="property.click(item)">
                      <fa-icon [icon]="property.icon"></fa-icon>
                    </button>
                  </td>
                  <td *ngSwitchCase="'date'" [ngStyle]='property.style || {}'>
                    {{property.val(item) | date:'short'}}
                  </td>
                  <td *ngSwitchCase="'image'" style="width:56px" [ngStyle]='property.style || {}'>
                    <img [src]="property.val(item) || property.empty" class="rounded" style="width:32px;height:32px"
                      [alt]="property.label">
                  </td>
                  <td *ngSwitchDefault [ngStyle]='property.style || {}'>
                    {{property.val(item) || '-'}}
                  </td>
                </ng-container>
              </ng-container>
            </tr>
          </tbody>
        </table>
      </ng-container>
    </ng-container>
    <ng-container *ngIf="showDebug">
      <app-debug title="data" [data]="data"></app-debug>
      <app-debug title="schema" [data]="schema"></app-debug>
    </ng-container>
  </div>
  <div class="d-flex justify-content-between p-3 bg-light">
    <ng-container *ngIf="!showDebug">
      <ng-container *ngIf="data.length">
        <div class="d-flex align-items-center">
          <span class="mr-2">Show</span>
          <select class="mr-2 form-control form-control-sm" (change)="resetLimit($event.target.value)">
            <option value="10" selected>10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <span class="mr-2">of</span>
          <strong class="mr-2">{{data.length}}</strong>
        </div>
        <ul *ngIf="data.length > limit" class="pagination pagination-sm m-0">
          <li class="page-item"><button class="page-link" (click)="previous()">Previous</button></li>
          <ng-container *ngFor="let p of pages">
            <li class="page-item" [ngClass]="{active:page === p}"><button class="page-link"
                (click)="page = p">{{p+1}}</button></li>
          </ng-container>
          <li class="page-item"><button class="page-link" (click)="next()">Next</button></li>
        </ul>
      </ng-container>
      <ng-container *ngIf="!data.length">
        <div class="d-flex align-items-center">
          <strong class="mr-2">No items were found</strong>
        </div>
      </ng-container>
    </ng-container>
    <ng-container *ngIf="showDebug">
      <div class="d-flex align-items-center">
        <strong class="mr-2">{{data.length}} items</strong>
      </div>
    </ng-container>
    <div ngbDropdown placement="top-right" container="body" class="d-inline-block">
      <button class="btn btn-outline-secondary border-0" ngbDropdownToggle>
        <fa-icon icon="bars"></fa-icon>
      </button>
      <div ngbDropdownMenu>
        <button ngbDropdownItem (click)="showDebug = !showDebug">
          <fa-icon icon="code" [fixedWidth]="true"></fa-icon> toggle data
        </button>
      </div>
    </div>
  </div>
</div>

<ng-template #empty>
  <div class="card p-5 text-center text-muted">
    <fa-icon icon="empty-set" size="4x"></fa-icon>
    <h2 style="font-weight:300">no data</h2>
  </div>
</ng-template>
